<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>4 - Running Batches 路 GEMS.jl</title><meta name="title" content="4 - Running Batches 路 GEMS.jl"/><meta property="og:title" content="4 - Running Batches 路 GEMS.jl"/><meta property="twitter:title" content="4 - Running Batches 路 GEMS.jl"/><meta name="description" content="Documentation for GEMS.jl."/><meta property="og:description" content="Documentation for GEMS.jl."/><meta property="twitter:description" content="Documentation for GEMS.jl."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../"><img src="../assets/logo.jpeg" alt="GEMS.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../">GEMS.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><span class="tocitem">Base Model</span><ul><li><a class="tocitem" href="../base-population/">Population</a></li><li><a class="tocitem" href="../base-contacts/">Contacts</a></li><li><a class="tocitem" href="../base-disease/">Disease</a></li><li><a class="tocitem" href="../TriSM/">Interventions</a></li></ul></li><li><span class="tocitem">Running Simulations</span><ul><li><a class="tocitem" href="../tut_Intro/">Tutorials</a></li><li><a class="tocitem" href="../tut_gettingstarted/">1 - Getting Started</a></li><li><a class="tocitem" href="../tut_exploring/">2 - Exploring Models</a></li><li><a class="tocitem" href="../tut_plotting/">3 - Plotting</a></li><li class="is-active"><a class="tocitem" href>4 - Running Batches</a><ul class="internal"><li><a class="tocitem" href="#Repeating-Simulations"><span>Repeating Simulations</span></a></li><li><a class="tocitem" href="#Sweeping-Parameter-Spaces"><span>Sweeping Parameter Spaces</span></a></li><li><a class="tocitem" href="#Running-Scenarios"><span>Running Scenarios</span></a></li><li><a class="tocitem" href="#Merging-Batches"><span>Merging Batches</span></a></li><li><a class="tocitem" href="#*BatchData*-Objects"><span><em>BatchData</em> Objects</span></a></li><li><a class="tocitem" href="#Custom-*BatchDataStyles*"><span>Custom <em>BatchDataStyles</em></span></a></li></ul></li><li><a class="tocitem" href="../tut_pops/">5 - Creating Populations</a></li><li><a class="tocitem" href="../tut_configfiles/">6 - Advanced Parameterization</a></li><li><a class="tocitem" href="../tut_postprocessing/">7 - Logging &amp; Post-Processing</a></li><li><a class="tocitem" href="../tut_reporting/">8 - Reporting</a></li><li><a class="tocitem" href="../tut_npi/">9 - Modeling Interventions</a></li><li><a class="tocitem" href="../tut_behavior/">10 - Modeling Behavior</a></li><li><a class="tocitem" href="../tut_contacts/">11 - Contact Structures</a></li><li><a class="tocitem" href="../tut_infections/">12 - Infections &amp; Immunity</a></li><li><a class="tocitem" href="../cheat-sheet/">Cheat Sheet</a></li></ul></li><li><a class="tocitem" href="../config-files/">Config Files</a></li><li><span class="tocitem">API</span><ul><li><a class="tocitem" href="../docstrings-overview/">Overview</a></li><li><a class="tocitem" href="../api_batch/">Batch Runs</a></li><li><a class="tocitem" href="../api_contacts/">Contacts</a></li><li><a class="tocitem" href="../api_individuals/">Individuals</a></li><li><a class="tocitem" href="../api_infections/">Infections and Immunity</a></li><li><a class="tocitem" href="../api_interventions/">Interventions</a></li><li><a class="tocitem" href="../api_logger/">Logger</a></li><li><a class="tocitem" href="../api_mapping/">Mapping</a></li><li><a class="tocitem" href="../api_misc/">Misc</a></li><li><a class="tocitem" href="../api_movie/">Movie</a></li><li><a class="tocitem" href="../api_pathogens/">Pathogens</a></li><li><a class="tocitem" href="../api_plotting/">Plotting</a></li><li><a class="tocitem" href="../api_population/">Population</a></li><li><a class="tocitem" href="../api_postproc/">Post Processing</a></li><li><a class="tocitem" href="../api_reporting/">Reporting</a></li><li><a class="tocitem" href="../api_resultdata/">Result Data</a></li><li><a class="tocitem" href="../api_settings/">Settings</a></li><li><a class="tocitem" href="../api_simulation/">Simulation</a></li></ul></li><li><a class="tocitem" href="../package-structure/">Package Structure</a></li><li><a class="tocitem" href="../contributing-guide/">Contributing to GEMS</a></li><li><a class="tocitem" href="../faq-page/">FAQ</a></li><li><a class="tocitem" href="../glossary/">Glossary</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Running Simulations</a></li><li class="is-active"><a href>4 - Running Batches</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>4 - Running Batches</a></li></ul></nav><div class="docs-right"><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="4-Running-Batches"><a class="docs-heading-anchor" href="#4-Running-Batches">4 - Running Batches</a><a id="4-Running-Batches-1"></a><a class="docs-heading-anchor-permalink" href="#4-Running-Batches" title="Permalink"></a></h1><p>In most situations, running a simulation once is not sufficient. This tutorial teaches you how to work with so-called batches of simulations.</p><h2 id="Repeating-Simulations"><a class="docs-heading-anchor" href="#Repeating-Simulations">Repeating Simulations</a><a id="Repeating-Simulations-1"></a><a class="docs-heading-anchor-permalink" href="#Repeating-Simulations" title="Permalink"></a></h2><p>You can instantiate a simulation multiple times and add them to a vector. The <code>Batch(...)</code> function creates a batch from multiple simulations. Running and post-processing of a batch works the same as for single simulations. Note that the <code>rd</code> variable in the example below now contains a vector of <code>ResultData</code> objects.</p><pre><code class="language-julia hljs">using GEMS

sims = Simulation[]
for i in 1:5
    sim = Simulation()
    push!(sims, sim)
end

b = Batch(sims...)
run!(b)
rd = ResultData(b)
gemsplot(rd)</code></pre><div class="admonition is-warning"><header class="admonition-header">TODO: PUT PLOT HERE AS IMAGE</header><div class="admonition-body"></div></div><p>Simulation runs are automatically named (<em>Simulation 1, Simulation 2, ...</em>) if no explicit label is provided. Passing a <code>label</code> keyword to the <code>Simulation()</code> function causes all simulation results of the same label to be grouped:</p><pre><code class="language-julia hljs">using GEMS

sims = Simulation[]
for i in 1:5
    sim = Simulation(label = &quot;My Experiment&quot;)
    push!(sims, sim)
end

b = Batch(sims...)
run!(b)
rd = ResultData(b)
gemsplot(rd)</code></pre><div class="admonition is-warning"><header class="admonition-header">TODO: PUT PLOT HERE AS IMAGE</header><div class="admonition-body"></div></div><h2 id="Sweeping-Parameter-Spaces"><a class="docs-heading-anchor" href="#Sweeping-Parameter-Spaces">Sweeping Parameter Spaces</a><a id="Sweeping-Parameter-Spaces-1"></a><a class="docs-heading-anchor-permalink" href="#Sweeping-Parameter-Spaces" title="Permalink"></a></h2><p>If you want to run simulations and systematically scan parameter spaces, you can use batches to do just that. Here&#39;s an example of how to run a basic simulation with varying <code>transmission_rate</code>s:</p><pre><code class="language-julia hljs">using GEMS

sims = Simulation[]
for i in 0:0.1:0.5
    sim = Simulation(transmission_rate = i, label = &quot;Transmission Rate $i&quot;)
    push!(sims, sim)
end

b = Batch(sims...)
run!(b)
rd = ResultData(b)
gemsplot(rd, legend = :topright)</code></pre><div class="admonition is-warning"><header class="admonition-header">TODO: PUT PLOT HERE AS IMAGE</header><div class="admonition-body"></div></div><h2 id="Running-Scenarios"><a class="docs-heading-anchor" href="#Running-Scenarios">Running Scenarios</a><a id="Running-Scenarios-1"></a><a class="docs-heading-anchor-permalink" href="#Running-Scenarios" title="Permalink"></a></h2><p>GEMS&#39; batch functionalities offer easy options to compare different scenarios and run multiple simulations for each of them. The example below compares a baseline scenario with a scenario with a lower <code>transmission_rate</code> and we assume that this is due to mask-wearing mandates. It spawns five simulations for each of the scenarios and puts them into the same batch, runs it, and visualizes the processed results:</p><pre><code class="language-julia hljs">using GEMS

sims = Simulation[]
for i in 1:5
    baseline = Simulation(transmission_rate = 0.2, label = &quot;Baseline&quot;)
    masks = Simulation(transmission_rate = 0.15, label = &quot;Mask Wearing&quot;)
    push!(sims, baseline)
    push!(sims, masks)
end

b = Batch(sims...)
run!(b)
rd = ResultData(b)
gemsplot(rd)</code></pre><div class="admonition is-warning"><header class="admonition-header">TODO: PUT PLOT HERE AS IMAGE</header><div class="admonition-body"></div></div><p>Use the <code>combined = :bylabel</code> keyword to show both scenarios side-by-side (pass the <code>ylims</code> attribute to unify axis-scaling):</p><pre><code class="language-julia hljs">gemsplot(rd, type = :TickCases, combined = :bylabel, ylims = (0, 2000))</code></pre><div class="admonition is-warning"><header class="admonition-header">TODO: PUT PLOT HERE AS IMAGE</header><div class="admonition-body"></div></div><p>Of course, all of this can also be done with much more complex intervention strategies. Please look up the interventions tutorial for examples.</p><h2 id="Merging-Batches"><a class="docs-heading-anchor" href="#Merging-Batches">Merging Batches</a><a id="Merging-Batches-1"></a><a class="docs-heading-anchor-permalink" href="#Merging-Batches" title="Permalink"></a></h2><p>Sometimes it&#39;s easier to build up batches individually and then merge them into one for execution. Here&#39;s an example of how that can be done based on the scenario of the previous chapter:</p><pre><code class="language-julia hljs">using GEMS

sims1 = Simulation[]
for i in 1:5
    baseline = Simulation(transmission_rate = 0.2, label = &quot;Baseline&quot;)
    push!(sims1, baseline)
end
b1 = Batch(sims1...)

sims2 = Simulation[]
for i in 1:5
    masks = Simulation(transmission_rate = 0.15, label = &quot;Mask Wearing&quot;)
    push!(sims2, masks)
end
b2 = Batch(sims2...)

combined_batch = merge(b1, b2)
run!(combined_batch)
rd = ResultData(combined_batch)
gemsplot(rd, type = :TickCases)</code></pre><div class="admonition is-warning"><header class="admonition-header">TODO: PUT PLOT HERE AS IMAGE</header><div class="admonition-body"></div></div><h2 id="*BatchData*-Objects"><a class="docs-heading-anchor" href="#*BatchData*-Objects"><em>BatchData</em> Objects</a><a id="*BatchData*-Objects-1"></a><a class="docs-heading-anchor-permalink" href="#*BatchData*-Objects" title="Permalink"></a></h2><p>While <code>ResultData</code> objects are the processed output of single simulation runs, <code>BatchData</code> objects are processed output of Batches. They contain aggregated data on the simulations, e.g., the average number of total infections including standard devation, confidence intervals and ranges. While you do not necessarily need a <code>BatchData</code> object to plot batches, they do contain a lot of helpful data. Here&#39;s an example:</p><pre><code class="language-julia hljs">using GEMS

sims = Simulation[]
for i in 1:5
    sim = Simulation(label = &quot;My Experiment&quot;)
    push!(sims, sim)
end

b = Batch(sims...)
run!(b)
bd = BatchData(b)
total_infections(bd)</code></pre><div class="admonition is-warning"><header class="admonition-header">TODO: PUT CONSOLE OUTPUT HERE</header><div class="admonition-body"></div></div><p>Run the <code>info(...)</code> function to get an overview of values that you can retrieve from a <code>BatchData</code> object by calling a function of the same name (e.g., <code>total_infections(...)</code>) on the <code>BatchData</code> object:</p><pre><code class="language-julia hljs">info(bd)</code></pre><div class="admonition is-warning"><header class="admonition-header">TODO: PUT CONSOLE OUTPUT HERE</header><div class="admonition-body"></div></div><p>It&#39;s also possible to directly pass <code>BatchData</code> objects to the <code>gemsplot()</code> function:</p><pre><code class="language-julia hljs">gemsplot(bd)</code></pre><div class="admonition is-warning"><header class="admonition-header">TODO: PUT PLOT HERE AS IMAGE</header><div class="admonition-body"></div></div><p>A <code>BatchData</code> object contains <code>ResultData</code> objects for each of the individual runs. Creating a <code>BatchData</code> object from a <code>Batch</code> (as in the example above), triggers the post processing for each of the simulations contained in the batch, i.e., generating their <code>ResultData</code> objects. You can access them like this:</p><pre><code class="language-julia hljs">runs(bd)</code></pre><div class="admonition is-warning"><header class="admonition-header">TODO: PUT CONSOLE OUTPUT HERE</header><div class="admonition-body"></div></div><p>However, these <code>ResultData</code> objects are generated using the batch-optimized <code>LightRD</code> style (look up the tutorial on  <code>ResultDataStyle</code>s). This style does not store raw data (such as the <code>infections</code> dataframe) as they are usually not particularly relevant for batches, reducing the required memory significantly.</p><p>If you still want the raw data for each of the simulation runs, you can pass the <code>DefaultResultData</code> style to the <code>BatchData(...)</code> function. Have a look at this example showing how to still get the raw data when working with batches:</p><pre><code class="language-julia hljs">bd = BatchData(b, rd_style = &quot;DefaultResultData&quot;)
rns = runs(bd)
infections(rns[1])</code></pre><div class="admonition is-warning"><header class="admonition-header">TODO: PUT CONSOLE OUTPUT HERE</header><div class="admonition-body"></div></div><h2 id="Custom-*BatchDataStyles*"><a class="docs-heading-anchor" href="#Custom-*BatchDataStyles*">Custom <em>BatchDataStyles</em></a><a id="Custom-*BatchDataStyles*-1"></a><a class="docs-heading-anchor-permalink" href="#Custom-*BatchDataStyles*" title="Permalink"></a></h2><p>t.b.d.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../tut_plotting/">芦 3 - Plotting</a><a class="docs-footer-nextpage" href="../tut_pops/">5 - Creating Populations 禄</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.8.1 on <span class="colophon-date" title="Wednesday 12 February 2025 21:49">Wednesday 12 February 2025</span>. Using Julia version 1.11.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
