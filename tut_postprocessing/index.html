<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>7 - Logging &amp; Post-Processing · GEMS.jl</title><meta name="title" content="7 - Logging &amp; Post-Processing · GEMS.jl"/><meta property="og:title" content="7 - Logging &amp; Post-Processing · GEMS.jl"/><meta property="twitter:title" content="7 - Logging &amp; Post-Processing · GEMS.jl"/><meta name="description" content="Documentation for GEMS.jl."/><meta property="og:description" content="Documentation for GEMS.jl."/><meta property="twitter:description" content="Documentation for GEMS.jl."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../"><img src="../assets/logo.jpeg" alt="GEMS.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../">GEMS.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../installation/">Installation</a></li><li><span class="tocitem">Base Model</span><ul><li><a class="tocitem" href="../base-population/">Population</a></li><li><a class="tocitem" href="../base-contacts/">Contacts</a></li><li><a class="tocitem" href="../base-disease/">Disease</a></li><li><a class="tocitem" href="../TriSM/">Interventions</a></li></ul></li><li><span class="tocitem">Running Simulations</span><ul><li><a class="tocitem" href="../tut_Intro/">Tutorials</a></li><li><a class="tocitem" href="../tut_gettingstarted/">1 - Getting Started</a></li><li><a class="tocitem" href="../tut_exploring/">2 - Exploring Models</a></li><li><a class="tocitem" href="../tut_plotting/">3 - Plotting</a></li><li><a class="tocitem" href="../tut_batches/">4 - Running Batches</a></li><li><a class="tocitem" href="../tut_pops/">5 - Creating Populations</a></li><li><a class="tocitem" href="../tut_configfiles/">6 - Advanced Parameterization</a></li><li class="is-active"><a class="tocitem" href>7 - Logging &amp; Post-Processing</a><ul class="internal"><li><a class="tocitem" href="#Internal-Loggers"><span>Internal Loggers</span></a></li><li><a class="tocitem" href="#The-PostProcessor"><span>The PostProcessor</span></a></li><li><a class="tocitem" href="#Custom-Post-Processing"><span>Custom Post-Processing</span></a></li><li><a class="tocitem" href="#The-ResultData-object"><span>The ResultData object</span></a></li><li><a class="tocitem" href="#Custom-ResultDataStyles"><span>Custom ResultDataStyles</span></a></li><li><a class="tocitem" href="#Custom-Loggers"><span>Custom Loggers</span></a></li></ul></li><li><a class="tocitem" href="../tut_reporting/">8 - Reporting</a></li><li><a class="tocitem" href="../tut_npi/">9 - Modeling Interventions</a></li><li><a class="tocitem" href="../tut_behavior/">10 - Modeling Behavior</a></li><li><a class="tocitem" href="../tut_contacts/">11 - Contact Structures</a></li><li><a class="tocitem" href="../tut_infections/">12 - Infections &amp; Immunity</a></li><li><a class="tocitem" href="../cheat-sheet/">Cheat Sheet</a></li></ul></li><li><a class="tocitem" href="../config-files/">Config Files</a></li><li><span class="tocitem">API</span><ul><li><a class="tocitem" href="../docstrings-overview/">Overview</a></li><li><a class="tocitem" href="../api_batch/">Batch Runs</a></li><li><a class="tocitem" href="../api_contacts/">Contacts</a></li><li><a class="tocitem" href="../api_individuals/">Individuals</a></li><li><a class="tocitem" href="../api_infections/">Infections and Immunity</a></li><li><a class="tocitem" href="../api_interventions/">Interventions</a></li><li><a class="tocitem" href="../api_logger/">Logger</a></li><li><a class="tocitem" href="../api_mapping/">Mapping</a></li><li><a class="tocitem" href="../api_misc/">Misc</a></li><li><a class="tocitem" href="../api_movie/">Movie</a></li><li><a class="tocitem" href="../api_pathogens/">Pathogens</a></li><li><a class="tocitem" href="../api_plotting/">Plotting</a></li><li><a class="tocitem" href="../api_population/">Population</a></li><li><a class="tocitem" href="../api_postproc/">Post Processing</a></li><li><a class="tocitem" href="../api_reporting/">Reporting</a></li><li><a class="tocitem" href="../api_resultdata/">Result Data</a></li><li><a class="tocitem" href="../api_settings/">Settings</a></li><li><a class="tocitem" href="../api_simulation/">Simulation</a></li></ul></li><li><a class="tocitem" href="../package-structure/">Package Structure</a></li><li><a class="tocitem" href="../contributing-guide/">Contributing to GEMS</a></li><li><a class="tocitem" href="../faq-page/">FAQ</a></li><li><a class="tocitem" href="../glossary/">Glossary</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Running Simulations</a></li><li class="is-active"><a href>7 - Logging &amp; Post-Processing</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>7 - Logging &amp; Post-Processing</a></li></ul></nav><div class="docs-right"><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="7-Logging-and-Post-Processing"><a class="docs-heading-anchor" href="#7-Logging-and-Post-Processing">7 - Logging &amp; Post-Processing</a><a id="7-Logging-and-Post-Processing-1"></a><a class="docs-heading-anchor-permalink" href="#7-Logging-and-Post-Processing" title="Permalink"></a></h1><p>GEMS offers a variety of options to collect data during simulation runs and process them to obtain aggregated statistics. This tutorial teaches you how to access the data and customize how data is being collected and processed.</p><h2 id="Internal-Loggers"><a class="docs-heading-anchor" href="#Internal-Loggers">Internal Loggers</a><a id="Internal-Loggers-1"></a><a class="docs-heading-anchor-permalink" href="#Internal-Loggers" title="Permalink"></a></h2><p>Accessing a simulation&#39;s internal loggers is easy. They can be accessed via <code>infectionlogger(sim)</code>,  <code>deathlogger(sim)</code>,  <code>testlogger(sim)</code>,  <code>pooltestlogger(sim)</code>,  <code>quarantinelogger(sim)</code>,  or <code>customlogger(sim)</code>. Here&#39;s the data that is being logged for all infections:</p><pre><code class="language-julia hljs">using GEMS
sim = Simulation()
run!(sim)
inf_logger = infectionlogger(sim)
dataframe(inf_logger)</code></pre><div class="admonition is-warning"><header class="admonition-header">TODO: PUT CONSOLE OUTPUT HERE</header><div class="admonition-body"></div></div><div class="admonition is-info"><header class="admonition-header">Where can I find out what these columns mean?</header><div class="admonition-body"><p>Put a <code>?</code> into the Julia REPL and call <code>help?&gt; dataframe(::InfectionLogger)</code> to get an overview of the columns that are available in the <code>InfectionLogger</code>&#39;s dataframe. Replace the argument <code>::InfectionLogger</code> with any of the other logger types to see their descriptions or look up the Logger section in the API documentation.</p></div></div><h2 id="The-PostProcessor"><a class="docs-heading-anchor" href="#The-PostProcessor">The PostProcessor</a><a id="The-PostProcessor-1"></a><a class="docs-heading-anchor-permalink" href="#The-PostProcessor" title="Permalink"></a></h2><p>The <code>PostProcessor</code> is the binding element between the raw data coming from the simulation&#39;s internal loggers and the <code>ResultData</code> object. It is instantiated with the <code>Simulation</code> object and performs some initial operations and joins on the raw data, and stores the results in internal dataframes (<code>infectionsDF</code>, <code>populationDF</code>, <code>deathsDF</code>, <code>testsDF</code>, <code>pooltestsDF</code>, <code>quarantinesDF</code>). An exception is the <code>sim_infectionsDF</code>-dataframe which only contains infections that happend during the simulation, exluding all initial, seeding infections. This example shows how the <code>PostProcessor</code>&#39;s internal infections-dataframe is already joined with data from the population-dataframe:</p><pre><code class="language-julia hljs">using GEMS
sim = Simulation()
run!(sim)
pp = PostProcessor(sim)

infectionsDF(pp)</code></pre><div class="admonition is-warning"><header class="admonition-header">TODO: PUT CONSOLE OUTPUT HERE</header><div class="admonition-body"></div></div><p>You might have noticed, that this dataframe contains characteristics about the infecting and infected individuals (e.g., <code>age</code> or <code>sex</code>) or whether they were detected. It is now much easier to use this data to calculate more sophisticated statistics such as an age-age contact matrix for infections. Many processing functions are already available. Here&#39;s how you can calculate the effective reproduction rate per time unit using the <code>PostProcessor</code>:</p><pre><code class="language-julia hljs">using GEMS
sim = Simulation()
run!(sim)
pp = PostProcessor(sim)

effectiveR(pp)</code></pre><div class="admonition is-warning"><header class="admonition-header">TODO: PUT CONSOLE OUTPUT HERE</header><div class="admonition-body"></div></div><div class="admonition is-info"><header class="admonition-header">Where&#39;s the list of availble post-processing functions?</header><div class="admonition-body"><p>Look up the Post-Processor section in the API documentation for a full list of available options.</p></div></div><h2 id="Custom-Post-Processing"><a class="docs-heading-anchor" href="#Custom-Post-Processing">Custom Post-Processing</a><a id="Custom-Post-Processing-1"></a><a class="docs-heading-anchor-permalink" href="#Custom-Post-Processing" title="Permalink"></a></h2><p>In some cases, you might want to add custom functionalities to the <code>PostProcessor</code>. The following example add a new post-processor function that calculates the number of infections where a older person infected a younger person:</p><pre><code class="language-julia hljs">using GEMS, DataFrames

function old_infects_young(pp::PostProcessor)
    infs = sim_infectionsDF(pp) # load the simulated infections
    filtered = infs[infs.age_a .&gt; infs.age_b, :] # filter for Age A &gt; Age B
    grouped = groupby(filtered, :tick) # group by simulation time (tick)
    res = combine(grouped, nrow =&gt; :count) # combine count
    return res
end

sim = Simulation()
run!(sim)
pp = PostProcessor(sim)

old_infects_young(pp)</code></pre><div class="admonition is-warning"><header class="admonition-header">TODO: PUT CONSOLE OUTPUT HERE</header><div class="admonition-body"></div></div><p>We advise doing any post-processing via the <code>PostProcessor</code> infrastructure whenever possible, as this will make it very easy to forward you custom results to a custom <code>ResultData</code> object. These things will be explained in the subsequent sections.</p><h2 id="The-ResultData-object"><a class="docs-heading-anchor" href="#The-ResultData-object">The ResultData object</a><a id="The-ResultData-object-1"></a><a class="docs-heading-anchor-permalink" href="#The-ResultData-object" title="Permalink"></a></h2><h2 id="Custom-ResultDataStyles"><a class="docs-heading-anchor" href="#Custom-ResultDataStyles">Custom ResultDataStyles</a><a id="Custom-ResultDataStyles-1"></a><a class="docs-heading-anchor-permalink" href="#Custom-ResultDataStyles" title="Permalink"></a></h2><ul><li>how to get custom post-processing functions in here?</li></ul><h2 id="Custom-Loggers"><a class="docs-heading-anchor" href="#Custom-Loggers">Custom Loggers</a><a id="Custom-Loggers-1"></a><a class="docs-heading-anchor-permalink" href="#Custom-Loggers" title="Permalink"></a></h2><p>A lot of data is recorded automatically, i.e., infections or deaths. If you want to collect data during the simulation run that is not available via the default loggers, you can add custom mechanics. The example below tracks how many infected individuals live in households that have 3 or more members. Doing so requires to set up a <code>CustomLogger(...)</code>. It takes an arbitrary number of arguments that must be one-argument functions whereas the argument has to be the simulation object. These functions are called once every step when running a simulation.</p><pre><code class="language-julia hljs">using GEMS
sim = Simulation()

function logging_func(sim)
    cnt = 0 # counting variable
    inds = individuals(sim)
    for i in inds
        h = household(i, sim)
        if infected(i) &amp;&amp; size(h) &gt;= 3
            cnt += 1
        end
    end
    return cnt
end

cl = CustomLogger(infected_in_large_households = logging_func)
customlogger!(sim, cl)

run!(sim)
rd = ResultData(sim)

gemsplot(rd, type = (:TickCases, :CustomLoggerPlot))</code></pre><div class="admonition is-warning"><header class="admonition-header">TODO: PUT PLOT HERE AS IMAGE</header><div class="admonition-body"></div></div><p>The <code>ResultData</code> object now contains a dataframe that contains the collected data of the custom logger with one column per argument function that was passed to the <code>CustomLogger(...)</code></p><pre><code class="language-julia hljs">customlogger(rd)</code></pre><div class="admonition is-warning"><header class="admonition-header">TODO: PUT CONSOLE OUTPUT HERE</header><div class="admonition-body"></div></div><p>You might have noticed, that loggers can severely slow down the simulation runtime if implemented inefficiently as they are executed in every step and potentially require iterations through all individuals every time. Julia provides a number of handy techniques that can speed up calculations significantly. If you feel confident using so-called lambda-functions, you can rewrite the above example to prevent unnecessary memory allocations. The code below does exactly the same as the code above, but takes a fraction of the time. </p><pre><code class="language-julia hljs">using GEMS
sim = Simulation()

pred_func(i, sim) = infected(i) &amp;&amp; size(household(i, sim)) &gt;= 3

cl = CustomLogger(infected_in_large_households =
    sim -&gt; count(i -&gt; pred_func(i, sim), population(sim)))
customlogger!(sim, cl)

run!(sim)
rd = ResultData(sim)

gemsplot(rd, type = (:TickCases, :CustomLoggerPlot))</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../tut_configfiles/">« 6 - Advanced Parameterization</a><a class="docs-footer-nextpage" href="../tut_reporting/">8 - Reporting »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.8.1 on <span class="colophon-date" title="Thursday 13 February 2025 12:07">Thursday 13 February 2025</span>. Using Julia version 1.11.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
