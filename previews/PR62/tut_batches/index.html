<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>4 - Running Batches · GEMS.jl</title><meta name="title" content="4 - Running Batches · GEMS.jl"/><meta property="og:title" content="4 - Running Batches · GEMS.jl"/><meta property="twitter:title" content="4 - Running Batches · GEMS.jl"/><meta name="description" content="Documentation for GEMS.jl."/><meta property="og:description" content="Documentation for GEMS.jl."/><meta property="twitter:description" content="Documentation for GEMS.jl."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../"><img src="../assets/logo.jpeg" alt="GEMS.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../">GEMS.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../installation/">Installation</a></li><li><span class="tocitem">Base Model</span><ul><li><a class="tocitem" href="../base-population/">Population</a></li><li><a class="tocitem" href="../base-contacts/">Contacts</a></li><li><a class="tocitem" href="../base-disease/">Disease</a></li><li><a class="tocitem" href="../TriSM/">Interventions</a></li><li><a class="tocitem" href="../base-config/">Default Parameters</a></li></ul></li><li><span class="tocitem">Running Simulations</span><ul><li><a class="tocitem" href="../tut_Intro/">Tutorials</a></li><li><a class="tocitem" href="../tut_gettingstarted/">1 - Getting Started</a></li><li><a class="tocitem" href="../tut_exploring/">2 - Exploring Models</a></li><li><a class="tocitem" href="../tut_plotting/">3 - Plotting</a></li><li class="is-active"><a class="tocitem" href>4 - Running Batches</a><ul class="internal"><li><a class="tocitem" href="#Repeating-Simulations"><span>Repeating Simulations</span></a></li><li><a class="tocitem" href="#Sweeping-Parameter-Spaces"><span>Sweeping Parameter Spaces</span></a></li><li><a class="tocitem" href="#Running-Scenarios"><span>Running Scenarios</span></a></li><li><a class="tocitem" href="#Merging-Batches"><span>Merging Batches</span></a></li><li><a class="tocitem" href="#*BatchData*-Objects"><span><em>BatchData</em> Objects</span></a></li><li><a class="tocitem" href="#Custom-*BatchDataStyles*"><span>Custom <em>BatchDataStyles</em></span></a></li></ul></li><li><a class="tocitem" href="../tut_pops/">5 - Creating Populations</a></li><li><a class="tocitem" href="../tut_configfiles/">6 - Advanced Parameterization</a></li><li><a class="tocitem" href="../tut_postprocessing/">7 - Logging &amp; Post-Processing</a></li><li><a class="tocitem" href="../tut_reporting/">8 - Reporting</a></li><li><a class="tocitem" href="../tut_npi/">9 - Modeling Interventions</a></li><li><a class="tocitem" href="../cheat-sheet/">Cheat Sheet</a></li></ul></li><li><a class="tocitem" href="../config-files/">Config Files</a></li><li><span class="tocitem">API</span><ul><li><a class="tocitem" href="../docstrings-overview/">Overview</a></li><li><a class="tocitem" href="../api_batch/">Batches</a></li><li><a class="tocitem" href="../api_contacts/">Contacts</a></li><li><a class="tocitem" href="../api_individuals/">Individuals</a></li><li><a class="tocitem" href="../api_infections/">Infections and Immunity</a></li><li><a class="tocitem" href="../api_interventions/">Interventions</a></li><li><a class="tocitem" href="../api_logger/">Logger</a></li><li><a class="tocitem" href="../api_mapping/">Mapping</a></li><li><a class="tocitem" href="../api_misc/">Misc</a></li><li><a class="tocitem" href="../api_movie/">Movie</a></li><li><a class="tocitem" href="../api_pathogens/">Pathogens</a></li><li><a class="tocitem" href="../api_plotting/">Plotting</a></li><li><a class="tocitem" href="../api_population/">Population</a></li><li><a class="tocitem" href="../api_postproc/">Post Processing</a></li><li><a class="tocitem" href="../api_reporting/">Reporting</a></li><li><a class="tocitem" href="../api_resultdata/">Result Data</a></li><li><a class="tocitem" href="../api_settings/">Settings</a></li><li><a class="tocitem" href="../api_simulation/">Simulation</a></li></ul></li><li><a class="tocitem" href="../contributing-guide/">Contributing to GEMS</a></li><li><a class="tocitem" href="../changelog/">Changelog</a></li><li><a class="tocitem" href="../faq-page/">FAQ</a></li><li><a class="tocitem" href="../glossary/">Glossary</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Running Simulations</a></li><li class="is-active"><a href>4 - Running Batches</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>4 - Running Batches</a></li></ul></nav><div class="docs-right"><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="4-Running-Batches"><a class="docs-heading-anchor" href="#4-Running-Batches">4 - Running Batches</a><a id="4-Running-Batches-1"></a><a class="docs-heading-anchor-permalink" href="#4-Running-Batches" title="Permalink"></a></h1><p>In most situations, running a simulation once is not sufficient. This tutorial teaches you how to work with so-called batches of simulations.</p><h2 id="Repeating-Simulations"><a class="docs-heading-anchor" href="#Repeating-Simulations">Repeating Simulations</a><a id="Repeating-Simulations-1"></a><a class="docs-heading-anchor-permalink" href="#Repeating-Simulations" title="Permalink"></a></h2><p>You can instantiate a simulation multiple times and add them to a vector. The <code>Batch(...)</code> function creates a batch from multiple simulations. Running and post-processing of a batch works the same as for single simulations. Note that the <code>rd</code> variable in the example below now contains a vector of <code>ResultData</code> objects.</p><pre><code class="language-julia hljs">using GEMS

sims = Simulation[]
for i in 1:5
    sim = Simulation()
    push!(sims, sim)
end

b = Batch(sims...)
run!(b)
rd = ResultData(b)
gemsplot(rd)</code></pre><p><strong>Plot</strong></p><p align="center">
    <img src="../assets/tutorials/tut_batches.png" width="80%"/>
</p><p>Simulation runs are automatically named (<em>Simulation 1, Simulation 2, ...</em>) if no explicit label is provided. Passing a <code>label</code> keyword to the <code>Simulation()</code> function causes all simulation results of the same label to be grouped:</p><pre><code class="language-julia hljs">using GEMS

sims = Simulation[]
for i in 1:5
    sim = Simulation(label = &quot;My Experiment&quot;)
    push!(sims, sim)
end

b = Batch(sims...)
run!(b)
rd = ResultData(b)
gemsplot(rd)</code></pre><p><strong>Plot</strong></p><p align="center">
    <img src="../assets/tutorials/tut_batches_labels.png" width="80%"/>
</p><h2 id="Sweeping-Parameter-Spaces"><a class="docs-heading-anchor" href="#Sweeping-Parameter-Spaces">Sweeping Parameter Spaces</a><a id="Sweeping-Parameter-Spaces-1"></a><a class="docs-heading-anchor-permalink" href="#Sweeping-Parameter-Spaces" title="Permalink"></a></h2><p>If you want to run simulations and systematically scan parameter spaces, you can use batches to do just that. Here&#39;s an example of how to run a basic simulation with varying <code>transmission_rate</code>s:</p><pre><code class="language-julia hljs">using GEMS

sims = Simulation[]
for i in 0:0.1:0.5
    sim = Simulation(transmission_rate = i, label = &quot;Transmission Rate $i&quot;)
    push!(sims, sim)
end

b = Batch(sims...)
run!(b)
rd = ResultData(b)
gemsplot(rd, legend = :topright)</code></pre><p><strong>Plot</strong></p><p align="center">
    <img src="../assets/tutorials/tut_batches_parameter-spaces.png" width="80%"/>
</p><p>You can also vary multiple parameters at once and show the results in a heatmap. This example runs simulations varying the <code>transmission_rate</code> and <code>time_to_recovery</code>, and plots the calculated <code>r0</code> value of all combinations in a heatmap:</p><pre><code class="language-julia hljs">using GEMS

xvals = []
yvals = []
outvals = []

# vary transmission rate
for tr in 0.1:0.01:0.2
    # vary time to recovery
    for rec in 2:10
        sim = Simulation(transmission_rate = tr, time_to_recovery = rec)
        run!(sim)
        rd = ResultData(sim, style = &quot;LightRD&quot;)

        # extract data for heatmap
        push!(xvals, tr)
        push!(yvals, rec)
        push!(outvals, r0(rd))
    end
end

gemsheatmap(xvals, yvals, outvals,
    xlabel = &quot;Transmission Rate&quot;,
    ylabel = &quot;Time to Recovery (Days)&quot;,
    colorbar_title = &quot;Basic Reproduction Number&quot;,
    color = :r0) </code></pre><p><strong>Plot</strong></p><p align="center">
    <img src="../assets/tutorials/tut_batches_sweep_heatmap.png" width="80%"/>
</p><div class="admonition is-info" id="How-can-I-run-more-than-one-repetition-per-combination?-9e34998c52a9636c"><header class="admonition-header">How can I run more than one repetition per combination?<a class="admonition-anchor" href="#How-can-I-run-more-than-one-repetition-per-combination?-9e34998c52a9636c" title="Permalink"></a></header><div class="admonition-body"><p>You can enclose the experiment in another loop, running each combination as many times as you want. The <code>gemsheatmap()</code> function can take multiple entries of the same (<code>xvals</code>, <code>yvals</code>) combinations. It automatically generates the mean value across observations. You can also change the aggregation function. Please lookup the <code>gemsheatmap()</code> documentation.</p></div></div><h2 id="Running-Scenarios"><a class="docs-heading-anchor" href="#Running-Scenarios">Running Scenarios</a><a id="Running-Scenarios-1"></a><a class="docs-heading-anchor-permalink" href="#Running-Scenarios" title="Permalink"></a></h2><p>GEMS&#39; batch functionalities offer easy options to compare different scenarios and run multiple simulations for each of them. The example below compares a baseline scenario with a scenario with a lower <code>transmission_rate</code> and we assume that this is due to mask-wearing mandates. It spawns five simulations for each of the scenarios and puts them into the same batch, runs it, and visualizes the processed results:</p><pre><code class="language-julia hljs">using GEMS

sims = Simulation[]
for i in 1:5
    baseline = Simulation(transmission_rate = 0.2, label = &quot;Baseline&quot;)
    masks = Simulation(transmission_rate = 0.15, label = &quot;Mask Wearing&quot;)
    push!(sims, baseline)
    push!(sims, masks)
end

b = Batch(sims...)
run!(b)
rd = ResultData(b)
gemsplot(rd)</code></pre><p><strong>Plot</strong></p><p align="center">
    <img src="../assets/tutorials/tut_batches_scenarios.png" width="80%"/>
</p><p>Use the <code>combined = :bylabel</code> keyword to show both scenarios side-by-side (pass the <code>ylims</code> attribute to unify axis-scaling):</p><pre><code class="language-julia hljs">gemsplot(rd, type = :TickCases, combined = :bylabel, ylims = (0, 2000))</code></pre><p><strong>Plot</strong></p><p align="center">
    <img src="../assets/tutorials/tut_batches_combined.png" width="60%"/>
</p><p>Of course, all of this can also be done with much more complex intervention strategies. Please look up the interventions tutorial for examples.</p><h2 id="Merging-Batches"><a class="docs-heading-anchor" href="#Merging-Batches">Merging Batches</a><a id="Merging-Batches-1"></a><a class="docs-heading-anchor-permalink" href="#Merging-Batches" title="Permalink"></a></h2><p>Sometimes it&#39;s easier to build up batches individually and then merge them into one for execution. Here&#39;s an example of how that can be done based on the scenario of the previous chapter:</p><pre><code class="language-julia hljs">using GEMS

sims1 = Simulation[]
for i in 1:5
    baseline = Simulation(transmission_rate = 0.2, label = &quot;Baseline&quot;)
    push!(sims1, baseline)
end
b1 = Batch(sims1...)

sims2 = Simulation[]
for i in 1:5
    masks = Simulation(transmission_rate = 0.15, label = &quot;Mask Wearing&quot;)
    push!(sims2, masks)
end
b2 = Batch(sims2...)

combined_batch = merge(b1, b2)
run!(combined_batch)
rd = ResultData(combined_batch)
gemsplot(rd, type = :TickCases)</code></pre><p><strong>Plot</strong></p><p align="center">
    <img src="../assets/tutorials/tut_batches_2.png" width="60%"/>
</p><h2 id="*BatchData*-Objects"><a class="docs-heading-anchor" href="#*BatchData*-Objects"><em>BatchData</em> Objects</a><a id="*BatchData*-Objects-1"></a><a class="docs-heading-anchor-permalink" href="#*BatchData*-Objects" title="Permalink"></a></h2><p>While <code>ResultData</code> objects are the processed output of single simulation runs, <code>BatchData</code> objects are processed output of Batches. They contain aggregated data on the simulations, e.g., the average number of total infections including standard deviation, confidence intervals and ranges. While you do not necessarily need a <code>BatchData</code> object to plot batches, they do contain a lot of helpful data. Here&#39;s an example:</p><pre><code class="language-julia hljs">using GEMS

sims = Simulation[]
for i in 1:5
    sim = Simulation(label = &quot;My Experiment&quot;)
    push!(sims, sim)
end

b = Batch(sims...)
run!(b)
bd = BatchData(b)
total_infections(bd)</code></pre><p><strong>Output</strong></p><pre><code class="nohighlight hljs">[ Info: 23:32:43 | Initializing Simulation [My Experiment] with default configuration 
...
[ Info: 23:32:56 | Running Simulation 1/5 [My Experiment]
[ Info: 23:32:57 | Running Simulation My Experiment
100.0%┣████████████████████████████████████████┫ 365 days/365 days [00:30&lt;00:00, 12 days/s]
...
[ Info: 23:35:44 | Processing Simulation 1/5 in Batch
...
Dict{String, Real} with 6 entries:
  &quot;upper_95&quot; =&gt; 76052.5
  &quot;max&quot;      =&gt; 76088
  &quot;min&quot;      =&gt; 75363
  &quot;lower_95&quot; =&gt; 75415.1
  &quot;mean&quot;     =&gt; 75733.8
  &quot;std&quot;      =&gt; 256.672</code></pre><p>Run the <code>info(...)</code> function to get an overview of values that you can retrieve from a <code>BatchData</code> object by calling a function of the same name (e.g., <code>total_infections(...)</code>) on the <code>BatchData</code> object:</p><pre><code class="language-julia hljs">info(bd)</code></pre><p><strong>Output</strong></p><pre><code class="nohighlight hljs">BatchData Entries
└ meta_data
  └ GEMS_version
  └ id
  └ execution_date
└ dataframes
  └ tick_cases
  └ effectiveR
  └ cumulative_disease_progressions
  └ cumulative_quarantines
  └ tests
└ sim_data
  └ total_tests
  └ number_of_runs
  └ attack_rate
  └ total_infections
  └ total_quarantines
  └ runs
└ system_data
...</code></pre><p>It&#39;s also possible to directly pass <code>BatchData</code> objects to the <code>gemsplot()</code> function:</p><pre><code class="language-julia hljs">gemsplot(bd)</code></pre><p><strong>Plot</strong></p><p align="center">
    <img src="../assets/tutorials/tut_batches_batchdata.png" width="80%"/>
</p><p>A <code>BatchData</code> object contains <code>ResultData</code> objects for each of the individual runs. Creating a <code>BatchData</code> object from a <code>Batch</code> (as in the example above), triggers the post processing for each of the simulations contained in the batch, i.e., generating their <code>ResultData</code> objects. You can access them like this:</p><pre><code class="language-julia hljs">runs(bd)</code></pre><p><strong>Output</strong></p><pre><code class="nohighlight hljs">5-element Vector{ResultData}:
 ResultData Object
└ Dataframes inside: 22
└ Config file: DefaultConf.toml
  └ Pathogens: [&quot;Covid19&quot;]
└ Population file: Not available.
  └ Individuals: 100000
  └ Settings: [&quot;Household&quot;, &quot;SchoolClass&quot;, &quot;Office&quot;]
└ Simulation:
  └ Total infections: 75363
  └ Attack rate: 0.75363
  └ Total quarantine days: 0
  └ Total tests: NamedTuple()
  └ Test detection rate: 0.0
...</code></pre><p>However, these <code>ResultData</code> objects are generated using the batch-optimized <code>LightRD</code> style (look up the tutorial on  <code>ResultDataStyle</code>s). This style does not store raw data (such as the <code>infections</code> dataframe) as they are usually not particularly relevant for batches, reducing the required memory significantly.</p><p>If you still want the raw data for each of the simulation runs, you can pass the <code>DefaultResultData</code> style to the <code>BatchData(...)</code> function. Have a look at this example showing how to still get the raw data when working with batches:</p><pre><code class="language-julia hljs">bd = BatchData(b, rd_style = &quot;DefaultResultData&quot;)
rns = runs(bd)
infections(rns[1])</code></pre><p><strong>Output</strong></p><pre><code class="nohighlight hljs">[ Info: 23:38:51 | Processing Simulation 1/5 in Batch
[ Info: 23:38:55 | Processing Simulation 2/5 in Batch
[ Info: 23:38:59 | Processing Simulation 3/5 in Batch
[ Info: 23:39:03 | Processing Simulation 4/5 in Batch
[ Info: 23:39:07 | Processing Simulation 5/5 in Batch
        23:39:12 | └ Done                                                            
75363×47 DataFrame
   Row │ infection_id  tick   id_a   id_b    infectious_tick  removed_tick  ⋯
       │ Int32         Int16  Int32  Int32   Int16            Int16         ⋯ 
       ┼───────────────────────────────────────────────────────────────────────
     1 │         1134     17  88197       1               17                ⋯    
     2 │        35969     56  59946       2               60                ⋯
    ⋮  |      ⋮          ⋮      ⋮      ⋮            ⋮              ⋮            ⋮     
 75362 │        36576     56  22625   99999               56
 75363 │         7133     34  92825  100000               36                ⋯
38 columns and 75359 rows omitted</code></pre><h2 id="Custom-*BatchDataStyles*"><a class="docs-heading-anchor" href="#Custom-*BatchDataStyles*">Custom <em>BatchDataStyles</em></a><a id="Custom-*BatchDataStyles*-1"></a><a class="docs-heading-anchor-permalink" href="#Custom-*BatchDataStyles*" title="Permalink"></a></h2><p>t.b.d.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../tut_plotting/">« 3 - Plotting</a><a class="docs-footer-nextpage" href="../tut_pops/">5 - Creating Populations »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.16.0 on <span class="colophon-date" title="Monday 17 November 2025 16:26">Monday 17 November 2025</span>. Using Julia version 1.12.1.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
